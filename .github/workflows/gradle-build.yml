# Uses Eclipse Temurin (OpenJDK build) installed by actions/setup-java.
# Temurin is distributed under the GNU General Public License, version 2,
# with the Classpath Exception (GPLv2 + CPE).
# See: https://openjdk.org/legal/gplv2+ce.html
name: CI

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04
    container: wpilib/ubuntu-base:22.04

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Add repository to git safe directories
        run: git config --global --add safe.directory $GITHUB_WORKSPACE
        
      - name: Fix gradlew line endings & permissions (if needed)
        run: |
          # Match "testMethod() PASSED" or "testMethod() FAILED" â€” the ()
          # distinguishes real test results from Gradle's "> Task :test FAILED"
          PASSED=$(grep -c '() PASSED$' test-output.log || true)
          FAILED=$(grep -c '() FAILED$' test-output.log || true)
          if [ "$PASSED" -eq 0 ] && [ "$FAILED" -eq 0 ]; then
            echo "::error::No test results found in output. Tests may not have run."
            exit 1
          fi
          
      - name: Run Spotless Check
        #continue-on-error: true
        run: ./gradlew spotlessCheck
